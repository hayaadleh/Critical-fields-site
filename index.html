<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Critical Fields</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono&display=swap" rel="stylesheet">
  <style>
    /* Styles specific to index.html sections to complement styles.css */
    /* Adjustments for the hero section's new copy length */
    .hero {
        padding: 4rem 2rem; /* Keep existing padding */
        text-align: center;
        max-width: 800px; /* Wider to accommodate new text */
        margin: 0 auto;
    }

    .hero .tagline {
        font-size: 1.8rem; /* Slightly larger for new main heading */
        font-weight: normal;
        text-transform: lowercase;
        margin-bottom: 1.5rem; /* More space below tagline */
    }

    .hero .intro {
        margin: 1.5rem 0 2.5rem; /* Adjusted margins */
        font-size: 1.05rem; /* Slightly larger font for readability */
        color: var(--color-text-secondary); /* Use secondary text color */
        line-height: 1.7; /* Increased line height */
        text-align: center; /* Center align for hero block */
    }

    .hero .cta {
        display: inline-block;
        padding: 0.6rem 1.2rem;
        border: 1px solid var(--color-accent-gold); /* Gold border */
        background: transparent;
        color: var(--color-accent-gold);
        text-decoration: none;
        font-size: 1rem;
        text-transform: lowercase;
        transition: all 0.3s ease;
    }
    .hero .cta:hover {
        background-color: var(--color-accent-gold);
        color: var(--color-dark-bg);
    }

    /* --- Platform Features Section Styles (now uses the new general styles) --- */
    #platform-features {
        padding: 3rem 2rem;
        max-width: 1200px;
        margin: 0 auto;
        background-color: var(--color-light-bg); /* Use light background variable */
        border-top: 1px solid var(--color-border);
        border-bottom: 1px solid var(--color-border);
    }

    #platform-features h2 {
        text-align: center;
        font-size: 1.8rem;
        margin-bottom: 2.5rem;
        color: var(--color-accent-teal); /* Use accent color */
        text-transform: lowercase;
        border-bottom: 2px solid var(--color-border);
        padding-bottom: 0.5rem;
        display: inline-block;
        margin-left: auto;
        margin-right: auto;
    }

    #platform-features h3 {
        font-size: 1.4rem;
        color: var(--color-accent-gold); /* Use accent color */
        margin-top: 2.5rem;
        margin-bottom: 1.5rem;
        text-transform: lowercase;
        padding-left: 0.5rem;
    }

    .content-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    /* New styles for homepage specific layout */
    .homepage-two-column {
        display: flex;
        flex-wrap: wrap; /* Allow wrapping */
        gap: 2rem;
        padding: 2rem;
        max-width: 1200px;
        margin: 0 auto;
        align-items: flex-start; /* Align tops */
    }
    .homepage-two-column > div {
        flex: 1; /* Distribute space */
        min-width: 300px; /* Minimum width before wrapping */
    }

    /* Styles for the "What we are reading" section on homepage */
    #what-we-are-reading-homepage {
        background-color: var(--color-light-bg);
        border: 1px solid var(--color-border);
        border-radius: 8px;
        box-shadow: 0 4px 12px var(--color-shadow);
        padding: 1.5rem;
        margin-left: 2rem; /* Example margin for separation */
        flex-grow: 1;
        max-width: 400px; /* Constrain width for a compact look */
    }
    #what-we-are-reading-homepage h3 {
        font-size: 1.2rem;
        margin-top: 0;
        margin-bottom: 1rem;
        color: var(--color-accent-teal);
        text-align: center;
        border-bottom: 1px dashed var(--color-border);
        padding-bottom: 0.5rem;
    }
    #what-we-are-reading-homepage .reading-item {
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px dashed var(--color-border);
    }
    #what-we-are-reading-homepage .reading-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }
    #what-we-are-reading-homepage .reading-item a {
        color: var(--color-text-primary);
        text-decoration: none;
        font-weight: 600;
        transition: color 0.3s ease;
    }
    #what-we-are-reading-homepage .reading-item a:hover {
        color: var(--color-accent-gold);
    }
    #what-we-are-reading-homepage .reading-item p {
        font-size: 0.85rem;
        color: var(--color-text-secondary);
        margin-top: 0.2rem;
    }

    /* Styles for the latest newsletter section (full width) */
    #latest-newsletter-section {
        background-color: var(--color-light-bg);
        border: 1px solid var(--color-border);
        border-radius: 8px;
        box-shadow: 0 4px 12px var(--color-shadow);
        padding: 2rem;
        margin: 3rem auto; /* Center with vertical margin */
        max-width: 1000px; /* Wider for full-width feel */
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }
    #latest-newsletter-section h3 {
        font-size: 1.8rem;
        color: var(--color-accent-teal);
        margin-top: 0;
        margin-bottom: 1rem;
        text-transform: lowercase;
    }
    #latest-newsletter-section .newsletter-image {
        max-width: 150px; /* Adjust size */
        height: auto;
        border-radius: 4px;
        margin-bottom: 1.5rem;
        border: 1px solid var(--color-border);
    }
    #latest-newsletter-section .newsletter-title {
        font-size: 1.5rem;
        color: var(--color-accent-gold);
        margin-bottom: 0.5rem;
        text-decoration: none;
        transition: color 0.3s ease;
    }
    #latest-newsletter-section .newsletter-title:hover {
        color: var(--color-accent-teal);
    }
    #latest-newsletter-section .newsletter-subtitle {
        font-size: 1rem;
        color: var(--color-text-secondary);
        margin-bottom: 1.5rem;
    }

    /* How to Use Section */
    #how-to-use-section {
        padding: 3rem 2rem;
        max-width: 1000px;
        margin: 3rem auto;
        background-color: var(--color-light-bg);
        border: 1px solid var(--color-border);
        border-radius: 8px;
        box-shadow: 0 4px 12px var(--color-shadow);
        text-align: center;
    }
    #how-to-use-section h2 {
        font-size: 1.8rem;
        color: var(--color-accent-teal);
        margin-bottom: 1.5rem;
        text-transform: lowercase;
    }
    #how-to-use-section p {
        font-size: 1.05rem;
        color: var(--color-text-secondary);
        line-height: 1.7;
        margin-bottom: 1rem;
    }
    #how-to-use-section ul {
        list-style: none;
        padding: 0;
        margin-top: 1.5rem;
    }
    #how-to-use-section li {
        margin-bottom: 0.8rem;
        font-size: 1rem;
        color: var(--color-text-primary);
        text-transform: lowercase;
    }
    #how-to-use-section li strong {
        color: var(--color-accent-gold);
    }
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .homepage-two-column {
            flex-direction: column;
            padding: 1rem;
            gap: 1rem;
        }
        #what-we-are-reading-homepage {
            margin-left: 0; /* Remove left margin on mobile */
            max-width: 100%; /* Take full width */
        }
        #latest-newsletter-section, #how-to-use-section {
            padding: 1.5rem;
            margin: 2rem auto;
        }
        #latest-newsletter-section h3, #how-to-use-section h2 {
            font-size: 1.5rem;
        }
        #latest-newsletter-section .newsletter-title {
            font-size: 1.2rem;
        }
        #latest-newsletter-section .newsletter-subtitle, #how-to-use-section p, #how-to-use-section li {
            font-size: 0.95rem;
        }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="navbar">
      <h1 class="logo">Critical Fields</h1>
      <ul class="nav-menu">
        <li><a href="index.html">Home</a></li>
        <li class="dropdown">
          <a href="fields.html">Fields</a>
          <ul class="dropdown-menu">
            <li><a href="fields.html?name=heterodox-economics">Heterodox Economics</a></li>
            <li><a href="fields.html?name=architectures-of-power">Architectures of Power</a></li>
            <li><a href="fields.html?name=the-digital-apparatus">The Digital Apparatus</a></li>
            <li><a href="fields.html?name=earth-systems">Earth Systems</a></li>
            <li><a href="fields.html?name=the-social-commons">The Social Commons</a></li>
            <li><a href="fields.html?name=critical-methodologies">Critical Methodologies</a></li>
          </ul>
        </li>
        <li><a href="resources.html">Archive</a></li>
        <li><a href="network.html">Network</a></li>
        <li><a href="about.html">About</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <section class="hero">
      <h2 class="tagline">Critical Fields: A Public Knowledge Project for Critical Thought.</h2>
      <p class="intro">
        We are a decentralized platform built by a network of scholars to map the landscape of critical studies. We believe knowledge should be a commons: a space for intentional learning, collective synthesis, and open exchange. Explore our Archive of essential resources, delve into curated Fields of inquiry, and contribute to our shared learning index.
      </p>
      <a href="fields.html" class="cta">enter the fields</a>
    </section>

    <div class="homepage-two-column">
        <!-- Middle Left: Platform-Wide Features (Field Notes) -->
        <div id="field-notes-section" style="flex: 2;"> <!-- Takes more space -->
            <h3 class="section-title">Recently Published Field Notes</h3>
            <div id="field-notes-container" class="content-grid">
                <p class="loading-message" id="field-notes-loading">loading field notes...</p>
            </div>
        </div>

        <!-- Middle Right: What We're Reading -->
        <div id="what-we-are-reading-homepage" style="flex: 1;"> <!-- Takes less space, more compact -->
            <h3>Chief Editors’ "What We're Reading"</h3>
            <div id="what-we-are-reading-container-homepage">
                <p class="loading-message" id="what-we-are-reading-loading-homepage">loading selections...</p>
            </div>
        </div>
    </div>

    <!-- Latest Newsletter Section (Full Width) -->
    <section id="latest-newsletter-section">
        <h3 class="section-title">Latest Weekly Newsletter</h3>
        <div id="latest-newsletter-container">
            <p class="loading-message" id="latest-newsletter-loading">loading newsletter...</p>
        </div>
    </section>

    <!-- How to Use Website Section -->
    <section id="how-to-use-section">
        <h2>How to Use This Site</h2>
        <p>Critical Fields is designed to be an interactive digital library and archive. Here’s a brief guide:</p>
        <ul>
            <li><strong>The Archive:</strong> Dive into our comprehensive, user-fed repository of critical resources. Use the advanced filters and search to find exactly what you need. Hover over items to read descriptions.</li>
            <li><strong>Fields:</strong> Explore curated, interdisciplinary lenses on specific critical conversations. Each field offers a focused collection of relevant archive content, essays, editor selections, and more.</li>
            <li><strong>Contribute:</strong> We believe in a knowledge commons. If you have a resource, insight, or analysis that aligns with our mission, we invite you to contribute and help build this collective project.</li>
        </ul>
        <p>This platform is a living project, growing and evolving with the contributions of its community.</p>
    </section>

    <section id="community-signup">
      <h2>Join Our Network</h2>
      <p>Become part of our growing community of thinkers and contributors. Receive updates, participate in discussions, and shape the future of critical learning.</p>
      <a href="#" class="cta">Sign Up Now</a> <!-- Link to actual signup form when ready -->
    </section>
  </main>

  <footer class="site-footer">
    <p>&copy; 2025 Critical Fields.</p>
  </footer>

  <script>
    // --- Configuration for Homepage Dynamic Content ---
    const FIELD_NOTES_SHEET_URL = 'https://docs.google.com/sheets/d/e/2PACX-1vR_PLACEHOLDER_FIELD_NOTES_ID/pub?gid=0&single=true&output=csv'; // Example: Could be a general sheet with a 'homepage' flag
    const WHAT_WE_ARE_READING_SHEET_URL = 'https://docs.google.com/sheets/d/e/2PACX-1vR_PLACEHOLDER_READING_ID/pub?gid=0&single=true&output=csv';
    const NEWSLETTERS_SHEET_URL = 'https://docs.google.com/sheets/d/e/2PACX-1vR_PLACEHOLDER_NEWSLETTERS_ID/pub?gid=0&single=true&output=csv';

    // Helper function to parse CSV data (reused across site)
    function parseCSV(csvText) {
        const lines = csvText.trim().split('\n');
        if (lines.length === 0) return [];

        const parseLine = (line) => {
            const values = [];
            let inQuote = false;
            let currentVal = '';
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    inQuote = !inQuote;
                    if (!inQuote && i < line.length - 1 && line[i+1] === '"') {
                        currentVal += '"';
                        i++;
                    }
                } else if (char === ',' && !inQuote) {
                    values.push(currentVal.trim());
                    currentVal = '';
                } else {
                    currentVal += char;
                }
            }
            values.push(currentVal.trim());
            return values;
        };

        const headers = parseLine(lines[0]).map(header => {
            return header.trim().replace(/[^a-zA-Z0-9]/g, '');
        });
        
        const data = [];
        for (let i = 1; i < lines.length; i++) {
            const values = parseLine(lines[i]);
            if (values.length !== headers.length) {
                console.warn(`Skipping malformed row (header/value count mismatch): ${lines[i]}`);
                continue;
            }
            const rowObject = {};
            headers.forEach((header, index) => {
                rowObject[header] = values[index];
            });
            data.push(rowObject);
        }
        return data;
    }

    // Generic function to fetch and display data
    async function fetchDataAndDisplay(url, targetContainerId, renderFunction, limit = 3) {
        const loadingElement = document.getElementById(`${targetContainerId.replace('-container', '')}-loading`);
        const container = document.getElementById(targetContainerId);
        
        if (loadingElement) {
            loadingElement.style.display = 'block';
        }
        container.innerHTML = '';

        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const csvText = await response.text();
            const data = parseCSV(csvText);

            if (data.length === 0) {
                container.innerHTML = `<p class="loading-message">no content available yet.</p>`;
                return;
            }

            const itemsToShow = data.slice(0, limit); 

            itemsToShow.forEach(item => {
                const card = renderFunction(item);
                if (card) {
                    container.appendChild(card);
                }
            });
        } catch (error) {
            console.error(`Error fetching or rendering data for ${targetContainerId}:`, error);
            container.innerHTML = `<p class="loading-message error-message">failed to load content. please check the sheet URL.</p>`;
        } finally {
            if (loadingElement) {
                loadingElement.style.display = 'none';
            }
        }
    }

    // --- Render Functions for Each Homepage Section Type ---

    function renderFieldNoteCard(item) {
        const card = document.createElement('a');
        card.href = item.Link || '#';
        card.target = '_blank';
        card.rel = 'noopener noreferrer';
        card.className = 'feature-card';
        card.innerHTML = `
            <div class="feature-card-content">
                <h4>${item.Title || 'untitled field note'}</h4>
                <p>${item.Summary || 'no summary provided.'}</p>
                <div class="feature-card-meta">
                    ${item.Author || 'anonymous'} &mdash; ${item.Date || 'n.d.'}
                </div>
            </div>
        `;
        return card;
    }

    function renderReadingCard(item) {
        const div = document.createElement('div'); // Using div as it's not a direct link card
        div.className = 'reading-item';
        div.innerHTML = `
            <a href="${item.Link || '#'}" target="_blank" rel="noopener noreferrer">${item.Title || 'untitled selection'}</a>
            <p>${item.Description || 'no description provided.'}</p>
            <p style="font-size: 0.75rem; color: var(--color-text-secondary); opacity: 0.7;">${item.Medium || 'item'} by ${item.AuthorCurator || 'the editors'}</p>
        `;
        return div;
    }

    function renderNewsletterCard(item) {
        const div = document.createElement('div');
        div.innerHTML = `
            ${item.ImageLink && item.ImageLink.startsWith('http') ? `<img src="${item.ImageLink}" alt="${item.Title || 'Newsletter image'}" class="newsletter-image" onerror="this.style.display='none';">` : ''}
            <a href="${item.Link || '#'}" target="_blank" rel="noopener noreferrer" class="newsletter-title">${item.Title || 'untitled newsletter'}</a>
            <p class="newsletter-subtitle">${item.Summary || 'no summary provided.'}</p>
            <p style="font-size: 0.8rem; color: var(--color-text-secondary); opacity: 0.7;">published ${item.Date || 'n.d.'}</p>
        `;
        return div;
    }

    // --- Initialize Data Loading on Page Load ---
    document.addEventListener('DOMContentLoaded', () => {
        // Field Notes section (Middle Left)
        fetchDataAndDisplay(FIELD_NOTES_SHEET_URL, 'field-notes-container', renderFieldNoteCard, 3); // Limit to 3 for homepage

        // What We're Reading section (Middle Right)
        fetchDataAndDisplay(WHAT_WE_ARE_READING_SHEET_URL, 'what-we-are-reading-container-homepage', renderReadingCard, 5); // Limit to 5 for compact list

        // Latest Newsletter (Full Width)
        fetchDataAndDisplay(NEWSLETTERS_SHEET_URL, 'latest-newsletter-container', renderNewsletterCard, 1); // Only the latest (1)
    });
  </script>
</body>
</html>