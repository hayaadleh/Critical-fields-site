<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Critical Fields</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono&display=swap" rel="stylesheet">
  <style>
    /* Styles specific to index.html sections to complement styles.css */
    /* Adjustments for the hero section's new copy length */
    .hero {
        padding: 2rem 2rem 1rem; /* Reduced padding */
        text-align: center;
        max-width: 800px;
        margin: 0 auto;
        border-bottom: 1px solid var(--color-border-dark);
        padding-bottom: 1.5rem; /* Reduced padding-bottom */
    }

    .hero .tagline {
        font-size: 1.8rem;
        font-weight: normal;
        text-transform: uppercase;
        margin-bottom: 1rem; /* Reduced margin */
        color: var(--color-accent-highlight);
    }

    .hero .intro { /* This class is now used by the blurb section below */
        margin: 1rem 0 1.5rem; /* Reduced margins */
        font-size: 1.05rem;
        color: var(--color-text-secondary);
        line-height: 1.7;
        text-align: left;
    }

    .hero .cta {
        display: inline-block;
        padding: 0.6rem 1.2rem;
        border: 1px solid var(--color-accent-highlight);
        background: transparent;
        color: var(--color-accent-highlight);
        text-decoration: none;
        font-size: 1rem;
        text-transform: lowercase;
        transition: all 0.3s ease;
    }
    .hero .cta:hover {
        background-color: var(--color-accent-highlight);
        color: var(--color-main-bg);
    }

    /* --- New Section Layouts for Homepage Content Blocks --- */
    .homepage-content-section {
        padding: 2rem 2rem; /* Reduced padding */
        max-width: 1200px;
        margin: 2rem auto; /* Reduced vertical margin between sections */
        background-color: var(--color-card-bg);
        border: 1px solid var(--color-border-dark);
        border-radius: 4px;
        box-shadow: var(--shadow-outset-top), var(--shadow-outset-bottom),
                    4px 4px 0px var(--color-border-dark);
        text-align: center;
    }

    /* New Spotlight Section Title */
    .spotlight-title {
        font-size: 1.6rem;
        font-weight: normal;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: var(--color-text-secondary);
        margin-bottom: 1rem; /* Reduced margin */
        text-align: center;
        display: block;
    }

    /* H3 titles within homepage content areas */
    .homepage-content-h3 {
        font-size: 1.4rem;
        color: var(--color-text-primary);
        margin-top: 0;
        margin-bottom: 1rem; /* Reduced margin */
        text-transform: lowercase;
        text-align: center;
        border-bottom: 1px dashed var(--color-border-dark);
        padding-bottom: 0.5rem;
        display: block;
        max-width: fit-content;
        margin-left: auto;
        margin-right: auto;
    }

    /* What We're Reading Rotator specific styles (now the main spotlight) */
    #what-we-are-reading-homepage-rotator-section {
        padding: 2rem 2rem; /* Reduced padding */
        max-width: 1200px;
        margin: 2rem auto; /* Reduced vertical margin */
        background-color: var(--color-card-bg);
        border: 1px solid var(--color-border-dark);
        border-radius: 4px;
        box-shadow: var(--shadow-outset-top), var(--shadow-outset-bottom),
                    4px 4px 0px var(--color-border-dark);
        position: relative;
        text-align: center;
    }

    .rotator-container {
        position: relative;
        overflow: hidden;
        width: 100%;
        min-height: 450px; /* Significantly increased min-height for dominant image */
        margin: 0 auto;
        border: 1px solid var(--color-border-light);
        border-radius: 4px;
        box-shadow: inset 1px 1px 0px var(--color-border-dark), inset -1px -1px 0px var(--color-border-light);
    }
    .rotator-slides-wrapper {
        display: flex;
        transition: transform 0.5s ease-in-out;
        height: 100%;
    }
    .rotator-slide {
        flex: 0 0 100%;
        width: 100%;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: flex-end; /* Align content to bottom */
        align-items: center;
        position: relative;
        min-height: 450px; /* Match container height */
        background-size: cover;
        background-position: center;
        border-radius: 4px;
        color: white;
    }
    .rotator-slide .overlay-content {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0.2)); /* Stronger gradient for readability */
        padding: 1.5rem; /* Increased padding for more space */
        text-align: center;
        width: 100%;
        box-sizing: border-box;
    }
    .rotator-slide h4 {
        margin: 0;
        font-size: 2rem; /* Larger title for spotlight */
        color: var(--color-accent-highlight);
        text-transform: uppercase; /* Uppercase for impact */
        line-height: 1.2;
        margin-bottom: 0.8rem;
    }
    .rotator-slide p {
        margin: 0;
        font-size: 1.1rem; /* Larger description for spotlight */
        color: var(--color-text-primary); /* Primary text color for readability */
        line-height: 1.6;
        opacity: 0.9;
    }
    .rotator-slide .source-meta {
        font-size: 0.9rem;
        color: var(--color-text-secondary);
        opacity: 0.8;
        margin-top: 0.8rem; /* More space */
    }

    .rotator-pagination-dots {
        text-align: center;
        margin-top: 1rem;
    }
    .rotator-dot {
        height: 8px;
        width: 8px;
        margin: 0 4px;
        background-color: var(--color-border-dark);
        border-radius: 50%;
        display: inline-block;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }
    .rotator-dot.active {
        background-color: var(--color-accent-highlight);
        transform: scale(1.2);
    }
    .rotator-arrow {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(0,0,0,0.6);
        color: white;
        border: none;
        padding: 0.3rem 0.6rem;
        cursor: pointer;
        font-size: 1.2rem;
        line-height: 1;
        border-radius: 3px;
        z-index: 10;
        opacity: 0.7;
        transition: opacity 0.2s ease;
    }
    .rotator-arrow:hover {
        opacity: 1;
    }
    .rotator-arrow.prev {
        left: 5px;
    }
    .rotator-arrow.next {
        right: 5px;
    }


    /* Homepage Two-Column Layout (Newsletter & Blurb) */
    .homepage-two-column-main {
        display: flex;
        flex-wrap: wrap;
        gap: 2rem;
        padding: 2rem;
        max-width: 1200px;
        margin: 2rem auto; /* Reduced vertical margin */
        align-items: flex-start;
    }
    .homepage-two-column-main > section {
        flex: 1;
        min-width: 300px;
        background-color: var(--color-card-bg);
        border: 1px solid var(--color-border-dark);
        border-radius: 4px;
        box-shadow: var(--shadow-outset-top), var(--shadow-outset-bottom),
                    4px 4px 0px var(--color-border-dark);
        padding: 1.5rem;
    }

    /* Newsletter Section */
    #latest-newsletter-section .newsletter-image {
        max-width: 100%;
        height: auto;
        border-radius: 4px;
        margin-bottom: 1.5rem;
        border: 1px solid var(--color-border-dark);
        box-shadow: 1px 1px 0px var(--color-border-dark);
    }
    #latest-newsletter-section .newsletter-title {
        font-size: 1.5rem;
        color: var(--color-accent-highlight);
        margin-bottom: 0.5rem;
        text-decoration: none;
        transition: color 0.3s ease;
    }
    #latest-newsletter-section .newsletter-title:hover {
        color: var(--color-ui-red-light);
    }
    #latest-newsletter-section .newsletter-subtitle {
        font-size: 1rem;
        color: var(--color-text-secondary);
        margin-bottom: 1.5rem;
    }

    /* Blurb Section */
    #blurb-section {
        text-align: center;
    }
    #blurb-section .homepage-content-h3 {
        margin-top: 0;
    }
    .intro-blurb { /* Specific class for blurb text */
        margin: 1.5rem auto 2.5rem;
        font-size: 1.05rem;
        color: var(--color-text-secondary);
        line-height: 1.7;
        text-align: left;
    }
    #blurb-section .cta {
        margin-top: 1rem;
    }


    /* How to Use Section */
    #how-to-use-section {
        padding: 2rem 2rem; /* Reduced padding */
        max-width: 1000px;
        margin: 2rem auto; /* Reduced margin */
        background-color: var(--color-card-bg);
        border: 1px solid var(--color-border-dark);
        border-radius: 4px;
        box-shadow: var(--shadow-outset-top), var(--shadow-outset-bottom),
                    4px 4px 0px var(--color-border-dark);
        text-align: center;
    }
    #how-to-use-section ul {
        list-style: none;
        padding: 0;
        margin-top: 1.5rem;
        text-align: left;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
        border: 1px solid var(--color-border-dark);
        padding: 1.5rem;
        background-color: var(--color-secondary-bg);
        border-radius: 4px;
        box-shadow: inset 1px 1px 0px var(--color-border-dark), inset -1px -1px 0px var(--color-border-light);
    }
    #how-to-use-section li {
        margin-bottom: 0.8rem;
        font-size: 1rem;
        color: var(--color-text-primary);
        text-transform: lowercase;
        position: relative;
        padding-left: 1.5em;
        border-bottom: 1px dashed var(--color-border-dark);
        padding-bottom: 0.8rem;
        line-height: 1.8;
    }
    #how-to-use-section li:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }
    #how-to-use-section li::before {
        content: '> ';
        color: var(--color-accent-highlight);
        position: absolute;
        left: 0;
        font-weight: bold;
    }
    #how-to-use-section li strong {
        color: var(--color-accent-highlight);
        font-weight: bold;
    }

    /* Community Signup Section */
    #community-signup {
        padding: 2rem 2rem; /* Reduced padding */
        max-width: 1000px;
        margin: 2rem auto; /* Reduced margin */
        background-color: var(--color-card-bg);
        border: 1px solid var(--color-border-dark);
        border-radius: 4px;
        box-shadow: var(--shadow-outset-top), var(--shadow-outset-bottom),
                    4px 4px 0px var(--color-border-dark);
        text-align: center;
    }
    #community-signup .section-title {
        margin-top: 0;
    }
    #community-signup p {
        font-size: 1.1rem;
        color: var(--color-text-secondary);
        max-width: 600px;
        margin: 0 auto 1.5rem; /* Reduced margin-bottom */
    }
    #community-signup .cta {
        margin-top: 0;
    }


    /* Responsive adjustments */
    @media (max-width: 768px) {
        .hero {
            padding: 2rem 1rem 1rem;
        }
        .tagline {
            font-size: 1.8rem;
        }
        .intro {
            font-size: 0.95rem;
        }

        .homepage-content-section {
            padding: 1.5rem 1rem;
            margin: 1.5rem auto;
        }
        .spotlight-title {
            font-size: 1.2rem;
            margin-bottom: 0.8rem;
        }
        #what-we-are-reading-homepage-rotator-section .rotator-container {
            min-height: 280px; /* Adjust for mobile */
        }
        .rotator-slide h4 {
            font-size: 1.5rem;
        }
        .rotator-slide p {
            font-size: 0.9rem;
        }
        .rotator-slide .source-meta {
            font-size: 0.8rem;
        }

        .homepage-two-column-main {
            flex-direction: column;
            padding: 1rem;
            gap: 1.5rem;
            margin: 1.5rem auto;
        }
        .homepage-two-column-main > section {
            padding: 1.5rem;
            min-width: unset;
        }
        .intro-blurb {
            text-align: center; /* Center blurb text on mobile */
        }

        #latest-newsletter-section .newsletter-title {
            font-size: 1.3rem;
        }
        #latest-newsletter-section .newsletter-subtitle {
            font-size: 0.9rem;
        }
        #how-to-use-section ul {
            padding: 1rem;
        }
        #how-to-use-section li {
            font-size: 0.9rem;
            line-height: 1.6;
        }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <nav class="navbar">
      <h1 class="logo">Critical Fields</h1>
      <ul class="nav-menu">
        <li><a href="index.html">Home</a></li>
        <li class="dropdown">
          <a href="fields.html">Fields</a>
          <ul class="dropdown-menu">
            <li><a href="fields.html?name=heterodox-economics">Heterodox Economics</a></li>
            <li><a href="fields.html?name=architectures-of-power">Architectures of Power</a></li>
            <li><a href="fields.html?name=the-digital-apparatus">The Digital Apparatus</a></li>
            <li><a href="fields.html?name=earth-systems">Earth Systems</a></li>
            <li><a href="fields.html?name=the-social-commons">The Social Commons</a></li>
            <li><a href="fields.html?name=critical-methodologies">Critical Methodologies</a></li>
          </ul>
        </li>
        <li><a href="resources.html">Archive</a></li>
        <li><a href="network.html">Network</a></li>
        <li><a href="about.html">About</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <!-- Main Hero Section (now just tagline and CTA) -->
    <section class="hero">
      <h2 class="tagline typewriter-text">A Public Knowledge Project for Critical Thought.</h2>
      <a href="fields.html" class="cta">enter the fields</a>
    </section>

    <!-- What We're Reading Section (Main Spotlight) -->
    <section id="what-we-are-reading-homepage-rotator-section" class="homepage-content-section">
        <h2 class="spotlight-title">What We're Reading</h2>
        <div id="what-we-are-reading-rotator-container" class="rotator-container">
            <p class="loading-message" id="what-we-are-reading-loading-homepage">
                <div class="loader"></div>
                loading selections...
            </p>
        </div>
        <div id="what-we-are-reading-pagination-dots" class="rotator-pagination-dots"></div>
    </section>

    <!-- Combined Newsletter & Blurb Sections -->
    <div class="homepage-two-column-main">
        <!-- Latest Newsletter Section -->
        <section id="latest-newsletter-section" class="homepage-content-section">
            <h3 class="homepage-content-h3">Latest Weekly Newsletter</h3>
            <div id="latest-newsletter-container">
                <p class="loading-message" id="latest-newsletter-loading">
                    <div class="loader"></div>
                    loading newsletter...
                </p>
            </div>
        </section>

        <!-- Blurb Section -->
        <section id="blurb-section" class="homepage-content-section">
            <h3 class="homepage-content-h3">About Critical Fields</h3>
            <p class="intro-blurb">
              Critical Fields is a public knowledge project built by a network of thinkers, mapping the landscape of critical thought. We believe learning should be a commonsâ€”especially for a generation navigating a world of algorithm-driven feeds and saturation. With infinite resources scattered across the web, we are returning to a more intentional model: one where people can follow their own curiosity, contribute to the learning of others, and build a knowledge commons together. To that end, we believe it is essential to archive, organize, and connect these resources with focus and intent.
              <br><br>
              At our core is the Archive, an open-access repository where our community preserves essential resources. From that foundation, we build "Fields": curated, interdisciplinary lenses used to interpret the collection. Guided by our editors, these thematic paradigms provide the structure needed to move beyond passive consumption to active, collective synthesis.
              <br><br>
              We rely on contributions from our community to identify, categorize, and preserve the essential learning resources that are often lost to the void. If you have a resource that belongs here, we invite you to submit it to our learning commons. But an archive is only the beginning. The interpretive work of making sense of this material within our "Fields" is a demanding and essential task, and we invite you to lend your voice and analysis to this living project.
            </p>
            <!-- CTA is now part of this section's content -->
            <a href="fields.html" class="cta">enter the fields</a>
        </section>
    </div>

    <!-- How to Use Website Section -->
    <section id="how-to-use-section" class="homepage-content-section">
        <h2 class="section-title">How to Use This Site</h2>
        <p>Critical Fields is a decentralized platform built by a network of scholars to map the landscape of critical studies. Explore our Archive of essential resources, delve into curated Fields of inquiry, and contribute to our shared learning index.</p>
    </section>

    <!-- Community Signup Section -->
    <section id="community-signup" class="homepage-content-section">
      <h2 class="section-title">Join Our Network</h2>
      <p>Become part of our growing community of thinkers and contributors. Receive updates, participate in discussions, and shape the future of critical learning.</p>
      <div style="text-align: center; margin-top: 2rem;">
        <a href="#" class="cta">Sign Up Now</a>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <p>&copy; 2025 Critical Fields.</p>
  </footer>

  <script>
    // --- Configuration for Homepage Dynamic Content ---
    const GOOGLE_SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRBl_Sy0Aw_idmkwuQSGVNloQj4PxOKr2J6d_4YDibJuOppgndtfFpH1HGgkecJR1M6LmDFsezIfaiC/pub?output=csv';
    const CORS_PROXY_BASE_URL = 'https://api.allorigins.win/raw?url=';
    const MAIN_ARCHIVE_SHEET_URL = CORS_PROXY_BASE_URL + encodeURIComponent(GOOGLE_SHEET_CSV_URL);


    // Helper function to parse CSV data (reused across site)
    function parseCSV(csvText) {
        const lines = csvText.trim().split('\n');
        if (lines.length === 0) return [];

        const parseLine = (line) => {
            const values = [];
            let inQuote = false;
            let currentVal = '';
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    inQuote = !inQuote;
                    if (!inQuote && i < line.length - 1 && line[i+1] === '"') {
                        currentVal += '"';
                        i++;
                    }
                } else if (char === ',' && !inQuote) {
                    values.push(currentVal.trim());
                    currentVal = '';
                } else {
                    currentVal += char;
                }
            }
            values.push(currentVal.trim());
            return values;
        };

        const headers = parseLine(lines[0]).map(header => {
            return header.trim().replace(/[^a-zA-Z0-9]/g, '');
        });
        
        const data = [];
        for (let i = 1; i < lines.length; i++) {
            const values = parseLine(lines[i]);
            if (values.length !== headers.length) {
                console.warn(`Skipping malformed row (header/value count mismatch): ${lines[i]}`);
                continue;
            }
            const rowObject = {};
            headers.forEach((header, index) => {
                rowObject[header] = values[index] ? values[index].toLowerCase().trim() : '';
            });
            data.push(rowObject);
        }
        return data;
    }

    // Generic function to fetch and display data, now with added filtering capability
    async function fetchDataAndDisplay(url, targetContainerId, renderFunction, limit = 3, filterCriterion = null) {
        const loadingElement = document.getElementById(`${targetContainerId.replace('-container', '')}-loading`);
        const container = document.getElementById(targetContainerId);
        
        if (loadingElement) {
            if (!loadingElement.dataset.originalText) {
                loadingElement.dataset.originalText = loadingElement.innerHTML;
            }
            loadingElement.innerHTML = '<div class="loader"></div>' + loadingElement.dataset.originalText;
            loadingElement.style.display = 'block';
        }
        container.innerHTML = '';

        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const csvText = await response.text();
            let data = parseCSV(csvText);

            if (filterCriterion) {
                data = data.filter(item => {
                    const itemValue = item[filterCriterion.column];
                    if (itemValue) {
                        const valuesInCell = itemValue.toLowerCase().split(',').map(v => v.trim());
                        return valuesInCell.includes(filterCriterion.value.toLowerCase());
                    }
                    return false;
                });
            }

            if (data.length === 0) {
                container.innerHTML = `<p class="loading-message">no content available yet.</p>`;
                return;
            }

            const itemsToShow = data.slice(0, limit); 

            if (targetContainerId === 'what-we-are-reading-rotator-container') {
                readingArticles = itemsToShow;
                renderReadingRotator();
            } else {
                itemsToShow.forEach(item => {
                    const card = renderFunction(item);
                    if (card) {
                        container.appendChild(card);
                    }
                });
            }
        } catch (error) {
            console.error(`Error fetching or rendering data for ${targetContainerId}:`, error);
            container.innerHTML = `<p class="loading-message error-message">failed to load content. please check the sheet URL.</p>`;
        } finally {
            if (loadingElement) {
                loadingElement.style.display = 'none';
            }
        }
    }

    // --- Rotator Variables for "What We're Reading" ---
    let readingArticles = [];
    let currentReadingIndex = 0;
    let readingIntervalId;
    const READING_ROTATION_INTERVAL = 8000;

    // --- Rotator Functions for "What We're Reading" ---
    function renderReadingRotator() {
        const rotatorContainer = document.getElementById('what-we-are-reading-rotator-container');
        const dotsContainer = document.getElementById('what-we-are-reading-pagination-dots');
        rotatorContainer.innerHTML = '';
        dotsContainer.innerHTML = '';

        if (readingArticles.length === 0) {
            rotatorContainer.innerHTML = `<p class="loading-message">no selections available yet.</p>`;
            return;
        }

        const slidesWrapper = document.createElement('div');
        slidesWrapper.className = 'rotator-slides-wrapper';
        rotatorContainer.appendChild(slidesWrapper);

        readingArticles.forEach((article, index) => {
            const slide = document.createElement('a');
            slide.href = article.Link || '#';
            slide.target = '_blank';
            slide.rel = 'noopener noreferrer';
            slide.className = 'rotator-slide';
            
            const imageUrl = article.ImageLink && article.ImageLink.startsWith('http') ? article.ImageLink : '';
            if (imageUrl) {
                slide.style.backgroundImage = `url('${imageUrl}')`;
            } else {
                slide.style.backgroundColor = 'var(--color-secondary-bg)';
                slide.style.backgroundImage = 'none';
            }

            slide.innerHTML = `
                <div class="overlay-content">
                    <h4>${article.Title || 'untitled selection'}</h4>
                    <p>${article.Description || 'no description provided.'}</p>
                    <div class="source-meta">${article.Medium || 'item'} by ${article.Author || 'the editors'} &mdash; ${article.Date || 'n.d.'}</div>
                </div>
            `;
            slidesWrapper.appendChild(slide);

            const dot = document.createElement('span');
            dot.className = 'rotator-dot';
            dot.dataset.index = index;
            dot.addEventListener('click', () => {
                stopReadingRotator();
                showReadingSlide(index);
                startReadingRotator();
            });
            dotsContainer.appendChild(dot);
        });

        const prevArrow = document.createElement('button');
        prevArrow.className = 'rotator-arrow prev';
        prevArrow.innerHTML = '&lsaquo;';
        prevArrow.addEventListener('click', () => {
            stopReadingRotator();
            showReadingSlide(currentReadingIndex - 1);
            startReadingRotator();
        });
        rotatorContainer.appendChild(prevArrow);

        const nextArrow = document.createElement('button');
        nextArrow.className = 'rotator-arrow next';
        nextArrow.innerHTML = '&rsaquo;';
        nextArrow.addEventListener('click', () => {
            stopReadingRotator();
            showReadingSlide(currentReadingIndex + 1);
            startReadingRotator();
        });
        rotatorContainer.appendChild(nextArrow);

        showReadingSlide(currentReadingIndex);
        startReadingRotator();
    }

    function showReadingSlide(index) {
        const slidesWrapper = document.querySelector('#what-we-are-reading-rotator-container .rotator-slides-wrapper');
        const dots = document.querySelectorAll('#what-we-are-reading-pagination-dots .rotator-dot');

        if (!slidesWrapper || slidesWrapper.children.length === 0) return;

        if (index >= readingArticles.length) {
            currentReadingIndex = 0;
        } else if (index < 0) {
            currentReadingIndex = readingArticles.length - 1;
        } else {
            currentReadingIndex = index;
        }

        slidesWrapper.style.transform = `translateX(-${currentReadingIndex * 100}%)`;

        dots.forEach((dot, i) => {
            dot.classList.toggle('active', i === currentReadingIndex);
        });
    }

    function startReadingRotator() {
        stopReadingRotator();
        if (readingArticles.length > 1) {
            readingIntervalId = setInterval(() => {
                showReadingSlide(currentReadingIndex + 1);
            }, READING_ROTATION_INTERVAL);
        }
    }

    function stopReadingRotator() {
        clearInterval(readingIntervalId);
    }

    function renderNewsletterCard(item) {
        const div = document.createElement('div');
        div.innerHTML = `
            ${item.ImageLink && item.ImageLink.startsWith('http') ? `<img src="${item.ImageLink}" alt="${item.Title || 'Newsletter image'}" class="newsletter-image" onerror="this.style.display='none';">` : ''}
            <a href="${item.Link || '#'}" target="_blank" rel="noopener noreferrer" class="newsletter-title">${item.Title || 'untitled newsletter'}</a>
            <p class="newsletter-subtitle">${item.Description || 'no summary provided.'}</p>
            <p style="font-size: 0.8rem; color: var(--color-text-secondary); opacity: 0.7;">published ${item.Date || 'n.d.'}</p>
        `;
        return div;
    }

    document.addEventListener('DOMContentLoaded', () => {
        fetchDataAndDisplay(MAIN_ARCHIVE_SHEET_URL, 'what-we-are-reading-rotator-container', null, 5, { column: 'Medium', value: 'Editor Selection' });
        fetchDataAndDisplay(MAIN_ARCHIVE_SHEET_URL, 'latest-newsletter-container', renderNewsletterCard, 1, { column: 'Medium', value: 'Newsletter' });
    });
  </script>
</body>
</html>
